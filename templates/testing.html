{% extends 'base.html' %}
{% load static %}

{% block title %} Online Imtihon - Savol {{ index|add:"1" }}{% endblock %}

{% block content %}

<div class="min-h-screen bg-gray-100 py-10 px-4 flex justify-center">
     <div class="bg-white shadow-xl rounded-2xl p-8 max-w-2xl w-full">
     <!-- Progress & Timer -->
     <div class="flex justify-between items-center mb-6">
          <div class="text-sm text-gray-600">
          Savol {{ index|add:1 }} / {{ total }}
          </div>
          <div id="timer" class="text-red-500 font-semibold"></div>
     </div>

     <!-- Savol -->
     <h2 class="text-xl font-semibold text-gray-800 mb-4">{{ question.text }}</h2>

     <!-- Javob variantlari -->
     <form method="post" class="space-y-4">
          {% csrf_token %}
          {% for answer in answers %}
          <label class="flex items-center p-4 bg-gray-50 border border-gray-200 rounded-xl cursor-pointer hover:bg-blue-50 transition">
               <input type="radio" name="answer" value="{{ answer.id }}" class="mr-4 scale-125" {% if selected == answer.id %}checked{% endif %}>
               <span class="text-gray-700">{{ answer.text }}</span>
          </label>
          {% endfor %}

          <!-- Navigatsiya tugmalari -->
          <div class="flex justify-between items-center mt-8">
          {% if index > 0 %}
               <button name="prev" class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-5 py-2 rounded-xl transition">← Orqaga</button>
          {% else %}
               <span></span>
          {% endif %}

          {% if index < total|add:'-1' %}
               <button name="next" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-xl transition">Keyingi →</button>
          {% else %}
               <button name="finish" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-xl transition">Yakunlash</button>
          {% endif %}
          </div>
     </form>
     </div>
     </div>

<!-- Timer JS -->
<script>
     const startTime = new Date("{{ start_time }}");
     const duration = {{ duration_minutes }} * 60;
     const timerEl = document.getElementById("timer");

     function updateTimer() {
          const now = new Date();
          const elapsed = Math.floor((now - startTime) / 1000);
          const remaining = duration - elapsed;

          if (remaining <= 0) {
               timerEl.textContent = "00:00";
               clearInterval(timerInterval);
               document.getElementById("finish-form").submit(); // tugatish
          } else {
               const minutes = String(Math.floor(remaining / 60)).padStart(2, '0');
               const seconds = String(remaining % 60).padStart(2, '0');
               timerEl.textContent = `${minutes}:${seconds}`;
          }
     }

     const timerInterval = setInterval(updateTimer, 1000);
     updateTimer();
</script>


{% endblock %}
